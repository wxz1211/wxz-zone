<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
<head>
    <title>谷立慧呀，给你比心</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <link rel="shortcut icon" href="${cxt.contextPath}/images/favicon.ico" type="image/x-icon">
    <link rel="bookmark" type="image/x-icon" href="${cxt.contextPath}/images/favicon.ico">
    <link rel="stylesheet" type="text/css" href="${cxt.contextPath}/css/love.css"/>
</head>
<body>

<div class="content">

    <center style="    background-color: #83b5a4;">
        <br/>
        <b style="background-color: darkgrey">咦 谷立慧 毕业happy呀 好喜欢你的咧
        </b>
    </center
    <div class="iw_wrapper " style="    background-color: #c5daaddb;">
        <ul class="iw_thumbs" id="iw_thumbs" style="    background-color: #32822b4a;">
            <li><img src="${cxt.contextPath}/images/thumbs/1.jpg" data-img="${cxt.contextPath}/images/full/1.jpg"
                     alt="Thumb1"/>
                <div>
                    <h2>她的笑容是四月的花,她的双唇吐着太阳的热烈</h2>
                    <p>她的眼睛是天上最亮的星, 她的娇音缓缓拨动我</p>
                </div>
            </li>
            <li><img src="${cxt.contextPath}/images/thumbs/2.jpg" data-img="${cxt.contextPath}/images/full/2.jpg"
                     alt="Thumb1"/>
                <div>
                    <h2>哪天我老了，还跟小孩一样,桌前给你写信,窗外风雨千樯</h2>
                    <p>第一句讲很想念你,最后写见字如面</p>
                </div>
            </li>
            <li><img src="${cxt.contextPath}/images/thumbs/3.jpg" data-img="${cxt.contextPath}/images/full/3.jpg"
                     alt="Thumb1"/>
                <div>
                    <h2>我想和你在一起，在某个小镇
                    </h2>
                    <p>共享无尽的黄昏,和绵绵不绝的钟声。</p>
                </div>
            </li>
            <li><img src="${cxt.contextPath}/images/thumbs/4.jpg" data-img="${cxt.contextPath}/images/full/4.jpg"
                     alt="Thumb1"/>
                <div>
                    <h2>我在这里,从未离开,在你之前</h2>
                    <p>我不是我,在你之后,只剩你我</p>
                </div>
            </li>
            <li><img src="${cxt.contextPath}/images/thumbs/5.jpg" data-img="${cxt.contextPath}/images/full/5.jpg"
                     alt="Thumb1"/>
                <div>
                    <h2>你是我的,半截的诗,半截用心爱着</h2>
                    <p>半截用肉体埋着,你是我的半截的诗,不许别人更改一个字</p>
                </div>
            </li>
            <li><img src="${cxt.contextPath}/images/thumbs/6.jpg" data-img="${cxt.contextPath}/images/full/6.jpg"
                     alt="Thumb1"/>
                <div>
                    <h2>我行过许多地方的桥，看过许多次数的云</h2>
                    <p>喝过许多种类的酒，却只爱过一个正当最好年龄的人。</p>
                </div>
            </li>
            <li><img src="${cxt.contextPath}/images/thumbs/7.jpg" data-img="${cxt.contextPath}/images/full/7.jpg"
                     alt="Thumb1"/>
                <div>
                    <h2>当我突然亲你的时候,你就什么话也别说,要么直接扑到我怀里</h2>
                    <p>要么就把我强硬地推开,这样我才能知道,是该说声抱歉,还是继续吻你</p>
                </div>
            </li>
            <li><img src="${cxt.contextPath}/images/thumbs/8.jpg" data-img="${cxt.contextPath}/images/full/8.jpg"
                     alt="Thumb1"/>
                <div>
                    <h2>人生一瞬百年，哪堪去去还还。</h2>
                    <p>无论尔在何处，只祈如水如船。</p>
                </div>
            </li>
            <li><img src="${cxt.contextPath}/images/thumbs/9.jpg" data-img="${cxt.contextPath}/images/full/9.jpg"
                     alt="Thumb1"/>
                <div>
                    <h2>我就仗着我遇见过你这一件事</h2>
                    <p>我就敢嘲笑全天下人的孤独和彷惶</p>
                </div>
            </li>
            <li><img src="${cxt.contextPath}/images/thumbs/10.jpg" data-img="${cxt.contextPath}/images/full/10.jpg"
                     alt="Thumb1"/>
                <div>
                    <h2>曾经我以为最湿润的地方是唇</h2>
                    <p>之后,我才发现最湿润的地方是眼</p>
                </div>
            </li>
            <li><img src="${cxt.contextPath}/images/thumbs/11.jpg" data-img="${cxt.contextPath}/images/full/11.jpg"
                     alt="Thumb1"/>
                <div>
                    <h2>一见你的眼睛 我便清醒起来,我更喜欢看你那晕红的双腮</h2>
                    <p>黄昏时的彩霞似的,谢谢你给我力量</p>
                </div>
            </li>
            <li><img src="${cxt.contextPath}/images/thumbs/12.jpg" data-img="${cxt.contextPath}/images/full/12.jpg"
                     alt="Thumb1"/>
                <div>
                    <h2>我想要在茅亭里看雨，假山边看蚂蚁，看蝴蝶恋爱，看蜘蛛结网</h2>
                    <p>看水、看船、看云、看瀑布，看谷立慧甜甜地睡觉</p>
                </div>
            </li>
            <li><img src="${cxt.contextPath}/images/thumbs/13.jpg" data-img="${cxt.contextPath}/images/full/13.jpg"
                     alt="猫"/>
                <div>
                    <h2>下辈子，要做你的一只猫。</h2>
                    <p>早晨，摇你起床，在你发起床气之前逃跑。</p>
                </div>
            </li>
            <li><img src="${cxt.contextPath}/images/thumbs/14.jpg" data-img="${cxt.contextPath}/images/full/14.jpg"
                     alt="Thumb1"/>
                <div>
                    <h2>今天我感到非常烦闷，我想念你，我想起夜幕降临的时候，和你踏着星光走去</h2>
                    <p>想起了灯光照着树叶的时候，踏着婆娑的灯影走去，想起了欲语又塞的时候</p>
                </div>
            </li>
            <li><img src="${cxt.contextPath}/images/thumbs/15.jpg" data-img="${cxt.contextPath}/images/full/15.jpg"
                     alt="Thumb1"/>
                <div>
                    <h2>若你愿意，我将会把十六岁的我念给你听
                    </h2>
                    <p>不需要再加修辞，他就是一首情诗</p>
                </div>
            </li>
        </ul>
    </div>
    <div id="iw_ribbon" class="iw_ribbon"><span class="iw_close"></span> <span
            class="iw_zoom">关闭</span></div>
</div>

<div class="footer">
    <a class="left" target="_blank">love is a </a>
    <a href="javascript:;" target="_blank"><strong>beautifulthings</strong></a>
    <a href="javascript:;" target="_blank">Photos by lovers</a>
</div>

<script src="${cxt.contextPath}/lovejs/jquery.min.js" type="text/javascript"></script>
<script type="text/javascript" src="${cxt.contextPath}/lovejs/jquery.masonry.min.js"></script>
<script type="text/javascript" src="${cxt.contextPath}/lovejs/jquery.easing.1.3.js"></script>
<script src="${cxt.contextPath}/lovejs/nb.js"></script>
<script src="${cxt.contextPath}/lovejs/Projector.js"></script>
<script src="${cxt.contextPath}/lovejs/CanvasRenderer.js"></script>
<script src="${cxt.contextPath}/lovejs/tween.min.js"></script>
<script src="${cxt.contextPath}/lovejs/Sparks.js"></script>
<script src="${cxt.contextPath}/lovejs/helvetiker_regular.typeface.js"></script>


<script>

    var container;

    var camera, scene, renderer;

    var group, text, plane;

    var targetRotation = 0;
    var targetRotationOnMouseDown = 0;

    var mouseX = 0;
    var mouseXOnMouseDown = 0;

    var windowHalfX = window.innerWidth / 2;
    var windowHalfY = window.innerHeight / 2;

    var heartShape, particleCloud, sparksEmitter, emitterPos;
    var _rotation = 0;
    var timeOnShapePath = 0;


    var $iw_thumbs = $('#iw_thumbs'),
            $iw_ribbon = $('#iw_ribbon'),
            $iw_ribbon_close = $iw_ribbon.children('span.iw_close'),
            $iw_ribbon_zoom = $iw_ribbon.children('span.iw_zoom');

    ImageWall = (function () {
        // window width and height
        var w_dim,
                // index of current image
                current = -1,
                isRibbonShown = false,
                isFullMode = false,
                // ribbon / images animation settings
                ribbonAnim = {speed: 500, easing: 'easeOutExpo'},
                imgAnim = {speed: 400, easing: 'jswing'},
                // init function : call masonry, calculate window dimentions, initialize some events
                init = function () {
                    $iw_thumbs.imagesLoaded(function () {
                        $iw_thumbs.masonry({
                            isAnimated: true
                        });
                    });
                    getWindowsDim();
                    initEventsHandler();
                },
                // calculate window dimentions
                getWindowsDim = function () {
                    w_dim = {
                        width: $(window).width(),
                        height: $(window).height()
                    };
                },
                // initialize some events
                initEventsHandler = function () {

                    // click on a image
                    $iw_thumbs.delegate('li', 'click', function () {
                        if ($iw_ribbon.is(':animated')) return false;

                        var $el = $(this);

                        if ($el.data('ribbon')) {
                            showFullImage($el);
                        }
                        else if (!isRibbonShown) {
                            isRibbonShown = true;

                            $el.data('ribbon', true);

                            // set the current
                            current = $el.index();

                            showRibbon($el);
                        }
                    });

                    // click ribbon close
                    $iw_ribbon_close.bind('click', closeRibbon);

                    // on window resize we need to recalculate the window dimentions
                    $(window).bind('resize', function () {
                        getWindowsDim();
                        if ($iw_ribbon.is(':animated'))
                            return false;
                        closeRibbon();
                    })
                            .bind('scroll', function () {
                                if ($iw_ribbon.is(':animated'))
                                    return false;
                                closeRibbon();
                            });

                },
                showRibbon = function ($el) {
                    var $img = $el.children('img'),
                            $descrp = $img.next();

                    // fadeOut all the other images
                    $iw_thumbs.children('li').not($el).animate({opacity: 0.2}, imgAnim.speed);

                    // increase the image z-index, and set the height to 100px (default height)
                    $img.css('z-index', 100)
                            .data('originalHeight', $img.height())
                            .stop()
                            .animate({
                                height: '100px'
                            }, imgAnim.speed, imgAnim.easing);

                    // the ribbon will animate from the left or right
                    // depending on the position of the image
                    var ribbonCssParam = {
                                top: $el.offset().top - $(window).scrollTop() - 6 + 'px'
                            },
                            descriptionCssParam,
                            dir;

                    if ($el.offset().left < (w_dim.width / 2)) {
                        dir = 'left';
                        ribbonCssParam.left = 0;
                        ribbonCssParam.right = 'auto';
                    }
                    else {
                        dir = 'right';
                        ribbonCssParam.right = 0;
                        ribbonCssParam.left = 'auto';
                    }

                    $iw_ribbon.css(ribbonCssParam)
                            .show()
                            .stop()
                            .animate({width: '100%'}, ribbonAnim.speed, ribbonAnim.easing, function () {
                                switch (dir) {
                                    case 'left' :
                                        descriptionCssParam = {
                                            'left': $img.outerWidth(true) + 'px',
                                            'text-align': 'left'
                                        };
                                        break;
                                    case 'right' :
                                        descriptionCssParam = {
                                            'left': '-200px',
                                            'text-align': 'right'
                                        };
                                        break;
                                }
                                ;
                                $descrp.css(descriptionCssParam).fadeIn();
                                // show close button and zoom
                                $iw_ribbon_close.show();
                                $iw_ribbon_zoom.show();
                            });

                },
                // close the ribbon
                // when in full mode slides in the middle of the page
                // when not slides left
                closeRibbon = function () {
                    isRibbonShown = false

                    $iw_ribbon_close.hide();
                    $iw_ribbon_zoom.hide();

                    if (!isFullMode) {

                        // current wall image
                        var $el = $iw_thumbs.children('li').eq(current);

                        resetWall($el);

                        // slide out ribbon
                        $iw_ribbon.stop()
                                .animate({width: '0%'}, ribbonAnim.speed, ribbonAnim.easing);

                    }
                    else {
                        $iw_ribbon.stop().animate({
                            opacity: 0.8,
                            height: '0px',
                            marginTop: w_dim.height / 2 + 'px' // half of window height
                        }, ribbonAnim.speed, function () {
                            $iw_ribbon.css({
                                'width': '0%',
                                'height': '126px',
                                'margin-top': '0px'
                            }).children('img').remove();
                        });

                        isFullMode = false;
                    }
                },
                resetWall = function ($el) {
                    var $img = $el.children('img'),
                            $descrp = $img.next();

                    $el.data('ribbon', false);

                    // reset the image z-index and height
                    $img.css('z-index', 1).stop().animate({
                        height: $img.data('originalHeight')
                    }, imgAnim.speed, imgAnim.easing);

                    // fadeOut the description
                    $descrp.fadeOut();

                    // fadeIn all the other images
                    $iw_thumbs.children('li').not($el).animate({opacity: 1}, imgAnim.speed);
                },
                showFullImage = function ($el) {
                    isFullMode = true;

                    $iw_ribbon_close.hide();

                    var $img = $el.children('img'),
                            large = $img.data('img'),

                            // add a loading image on top of the image
                            $loading = $('<span class="iw_loading"></span>');

                    $el.append($loading);

                    // preload large image
                    $('<img/>').load(function () {
                        var $largeImage = $(this);

                        $loading.remove();

                        $iw_ribbon_zoom.hide();

                        resizeImage($largeImage);

                        // reset the current image in the wall
                        resetWall($el);

                        // animate ribbon in and out
                        $iw_ribbon.stop().animate({
                            opacity: 1,
                            height: '0px',
                            marginTop: '63px' // half of ribbons height
                        }, ribbonAnim.speed, function () {
                            // add the large image to the DOM
                            $iw_ribbon.prepend($largeImage);

                            $iw_ribbon_close.show();

                            $iw_ribbon.animate({
                                height: '100%',
                                marginTop: '0px',
                                top: '0px'
                            }, ribbonAnim.speed);
                        });
                    }).attr('src', large);

                },
                resizeImage = function ($image) {
                    var widthMargin = 100,
                            heightMargin = 100,

                            windowH = w_dim.height - heightMargin,
                            windowW = w_dim.width - widthMargin,
                            theImage = new Image();

                    theImage.src = $image.attr("src");

                    var imgwidth = theImage.width,
                            imgheight = theImage.height;

                    if ((imgwidth > windowW) || (imgheight > windowH)) {
                        if (imgwidth > imgheight) {
                            var newwidth = windowW,
                                    ratio = imgwidth / windowW,
                                    newheight = imgheight / ratio;

                            theImage.height = newheight;
                            theImage.width = newwidth;

                            if (newheight > windowH) {
                                var newnewheight = windowH,
                                        newratio = newheight / windowH,
                                        newnewwidth = newwidth / newratio;

                                theImage.width = newnewwidth;
                                theImage.height = newnewheight;
                            }
                        }
                        else {
                            var newheight = windowH,
                                    ratio = imgheight / windowH,
                                    newwidth = imgwidth / ratio;

                            theImage.height = newheight;
                            theImage.width = newwidth;

                            if (newwidth > windowW) {
                                var newnewwidth = windowW,
                                        newratio = newwidth / windowW,
                                        newnewheight = newheight / newratio;

                                theImage.height = newnewheight;
                                theImage.width = newnewwidth;
                            }
                        }
                    }

                    $image.css({
                        'width': theImage.width + 'px',
                        'height': theImage.height + 'px',
                        'margin-left': -theImage.width / 2 + 'px',
                        'margin-top': -theImage.height / 2 + 'px'
                    });
                };

        return {init: init};
    })();

    ImageWall.init();


    init();
    animate();


    function init() {

        container = document.createElement('div');
        $('.content').append(container);


        //相机
        camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 1000);
        camera.position.set(0, 150, 800);

        //场景
        scene = new THREE.Scene();

        group = new THREE.Group();
        scene.add(group);

        // Get text from hash

        var string = " I 1ove u";
        var hash = document.location.hash.substr(1);

        if (hash.length !== 0) {

            string = hash;

        }

        var text3d = new THREE.TextGeometry(string, {
            size: 60,
            height: 20,
            curveSegments: 2,
            font: "helvetiker"

        });

        text3d.computeBoundingBox();
        var centerOffset = -0.5 * (text3d.boundingBox.max.x - text3d.boundingBox.min.x);

        var textMaterial = new THREE.MeshBasicMaterial({color: Math.random() * 0xffffff, overdraw: 0.5});

        text = new THREE.Mesh(text3d, textMaterial);

        // Potentially, we can extract the vertices or faces of the text to generate particles too.
        // Geo > Vertices > Position

        text.position.x = centerOffset;
        text.position.y = 100;
        text.position.z = 0;

        text.rotation.x = 0;
        text.rotation.y = Math.PI * 2;

        group.add(text);


        particleCloud = new THREE.Object3D(); // Just a group
        particleCloud.y = 800;
        group.add(particleCloud);

        // Create Particle Systems

        // Heart

        var x = 0, y = 0;

        heartShape = new THREE.Shape();

        heartShape.moveTo(x + 25, y + 25);
        heartShape.bezierCurveTo(x + 25, y + 25, x + 20, y, x, y);
        heartShape.bezierCurveTo(x - 30, y, x - 30, y + 35, x - 30, y + 35);
        heartShape.bezierCurveTo(x - 30, y + 55, x - 10, y + 77, x + 25, y + 95);
        heartShape.bezierCurveTo(x + 60, y + 77, x + 80, y + 55, x + 80, y + 35);
        heartShape.bezierCurveTo(x + 80, y + 35, x + 80, y, x + 50, y);
        heartShape.bezierCurveTo(x + 35, y, x + 25, y + 25, x + 25, y + 25);

        var hue = 0;

        var hearts = function (context) {

            context.globalAlpha = 0.5;
            var x = 0, y = 0;
            context.scale(0.05, -0.05); // Scale so canvas render can redraw within bounds
            context.beginPath();
            // From
            context.bezierCurveTo(x + 2.5, y + 2.5, x + 2.0, y, x, y);
            context.bezierCurveTo(x - 3.0, y, x - 3.0, y + 3.5, x - 3.0, y + 3.5);
            context.bezierCurveTo(x - 3.0, y + 5.5, x - 1.0, y + 7.7, x + 2.5, y + 9.5);
            context.bezierCurveTo(x + 6.0, y + 7.7, x + 8.0, y + 5.5, x + 8.0, y + 3.5);
            context.bezierCurveTo(x + 8.0, y + 3.5, x + 8.0, y, x + 5.0, y);
            context.bezierCurveTo(x + 3.5, y, x + 2.5, y + 2.5, x + 2.5, y + 2.5);
            context.fill();
            context.lineWidth = 0.5; //0.05
            context.stroke();

        }

        var setTargetParticle = function () {

            var material = new THREE.SpriteCanvasMaterial({
                program: hearts
            });

            material.color.setHSL(hue, 1, 0.75);
            hue += 0.001;
            if (hue > 1)
                hue -= 1;

            particle = new THREE.Sprite(material);

            particle.scale.x = particle.scale.y = Math.random() * 40 + 40;
            particleCloud.add(particle);

            return particle;

        };

        var onParticleCreated = function (p) {

            p.target.position.copy(p.position);

        };

        var onParticleDead = function (particle) {

            particle.target.visible = false;
            particleCloud.remove(particle.target);

        };

        sparksEmitter = new SPARKS.Emitter(new SPARKS.SteadyCounter(160));

        emitterpos = new THREE.Vector3();

        sparksEmitter.addInitializer(new SPARKS.Position(new SPARKS.PointZone(emitterpos)));
        sparksEmitter.addInitializer(new SPARKS.Lifetime(0, 2));
        sparksEmitter.addInitializer(new SPARKS.Target(null, setTargetParticle));

        sparksEmitter.addInitializer(new SPARKS.Velocity(new SPARKS.PointZone(new THREE.Vector3(0, -50, 10))));

        // TOTRY Set velocity to move away from centroid

        sparksEmitter.addAction(new SPARKS.Age());
        //sparksEmitter.addAction(new SPARKS.Accelerate(0.2));
        sparksEmitter.addAction(new SPARKS.Move());
        sparksEmitter.addAction(new SPARKS.RandomDrift(50, 50, 2000));

        sparksEmitter.addCallback("created", onParticleCreated);
        sparksEmitter.addCallback("dead", onParticleDead);
        sparksEmitter.addCallback("updated", function (particle) {

            particle.target.position.copy(particle.position);

        });

        sparksEmitter.start();

        // End Particles


        renderer = new THREE.CanvasRenderer();
        renderer.setClearColor(0xf0f0f0);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        container.appendChild(renderer.domElement);

        document.addEventListener('mousedown', onDocumentMouseDown, false);
        document.addEventListener('touchstart', onDocumentTouchStart, false);
        document.addEventListener('touchmove', onDocumentTouchMove, false);

        //

        window.addEventListener('resize', onWindowResize, false);

    }

    function onWindowResize() {

        windowHalfX = window.innerWidth / 2;
        windowHalfY = window.innerHeight / 2;

        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();

        renderer.setSize(window.innerWidth, window.innerHeight);

    }

    //

    document.addEventListener('mousemove', onDocumentMouseMove, false);

    function onDocumentMouseDown(event) {

        event.preventDefault();

        mouseXOnMouseDown = event.clientX - windowHalfX;
        targetRotationOnMouseDown = targetRotation;

        if (sparksEmitter.isRunning()) {

            sparksEmitter.stop();

        } else {

            sparksEmitter.start();

        }

    }

    function onDocumentMouseMove(event) {

        mouseX = event.clientX - windowHalfX;

        targetRotation = targetRotationOnMouseDown + (mouseX - mouseXOnMouseDown) * 0.02;

    }

    function onDocumentTouchStart(event) {

        if (event.touches.length == 1) {

            event.preventDefault();

            mouseXOnMouseDown = event.touches[0].pageX - windowHalfX;
            targetRotationOnMouseDown = targetRotation;

        }

    }

    function onDocumentTouchMove(event) {

        if (event.touches.length == 1) {

            event.preventDefault();

            mouseX = event.touches[0].pageX - windowHalfX;
            targetRotation = targetRotationOnMouseDown + (mouseX - mouseXOnMouseDown) * 0.05;

        }

    }

    //

    function animate() {//更新场景

        requestAnimationFrame(animate);

        render();

    }

    function render() {

        timeOnShapePath += 0.0337;

        if (timeOnShapePath > 1)
            timeOnShapePath -= 1;

        // TODO Create a PointOnShape Action/Zone in the particle engine
        var pointOnShape = heartShape.getPointAt(timeOnShapePath);

        emitterpos.x = pointOnShape.x * 5 - 100;
        emitterpos.y = -pointOnShape.y * 5 + 400;

        // Pretty cool effect if you enable this
        // particleCloud.rotation.y += 0.05;

        group.rotation.y += (targetRotation - group.rotation.y) * 0.05;
        renderer.render(scene, camera);
    }
</script>

<div style="text-align:center;margin:50px 0; font:normal 14px/24px 'MicroSoft YaHei';">
    <p>以爱的名义~</p>
    <p>design by<a href="" target="_blank">WXZ</a></p>
</div>
</body>
</html>